#!/usr/bin/env bash
# bin/compile <build-dir> <cache-dir>

# fail fast
set -e

logger -p user.notice -t "slugc[$$]" "language_pack_java java_compile_start"

BIN_DIR=$(cd $(dirname $0); pwd) # absolute path
# parse args
BUILD_DIR=$1
CACHE_DIR=$2
LOGGER_FLAGS=""
BUILDPACK_DIR="$(dirname ${BIN_DIR})"


echo '==> Layout out Solr'
#miles of files!
ls -lah "${BUILDPACK_DIR}"
cp -R "${BUILDPACK_DIR}/overlay/*" /
ln -s "$1/solr.xml" "/solr-home/solr.xml"
ln -s "$1/cores" "/solr-home/cores"

echo '==> Installing Oracle Java 1.7'
#Custom repo for Java 1.7
sudo apt-get install -y python-software-properties software-properties-common
add-apt-repository -y ppa:webupd8team/java
apt-get -y -qq update
apt-key adv --keyserver keyserver.ubuntu.com --recv-keys EEA14886
#Auto accept installer prompts
echo debconf shared/accepted-oracle-license-v1-1 select true | sudo debconf-set-selections
echo debconf shared/accepted-oracle-license-v1-1 seen true | sudo debconf-set-selections
echo oracle-java7-installer shared/accepted-oracle-license-v1-1 select true | sudo /usr/bin/debconf-set-selections
##install
apt-get install -y oracle-java7-installer
apt-get install oracle-java7-set-default

